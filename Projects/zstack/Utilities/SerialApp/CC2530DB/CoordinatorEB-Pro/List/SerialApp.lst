###############################################################################
#
# IAR C/C++ Compiler V10.20.1.5333 for 8051               18/Jun/2021  17:52:29
# Copyright 2004-2018 IAR Systems AB.
# PC-locked license - IAR Embedded Workbench for 8051
#
#    Core               =  plain
#    Code model         =  banked
#    Data model         =  large
#    Calling convention =  xdata reentrant
#    Constant location  =  data_rom
#    Dptr setup         =  1,16
#                          
#    Source file        =  
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\Source\SerialApp.c
#    Command line       =  
#        -f C:\Users\ADMINI~1\AppData\Local\Temp\EWDDFC.tmp
#        (D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\Source\SerialApp.c
#        -D ZIGBEEPRO -D HAL_UART=TRUE -D SERIAL_APP_PORT=0 -D LCD_SUPPORTED
#        -lC
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\CoordinatorEB-Pro\List
#        -lA
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\CoordinatorEB-Pro\List
#        --diag_suppress Pe001,Pa010 -o
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\CoordinatorEB-Pro\Obj
#        -e --debug --core=plain --dptr=16,1 --data_model=large
#        --code_model=banked --calling_convention=xdata_reentrant
#        --place_constants=data_rom --nr_virtual_regs 8 -f
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg
#        (-DCPU32MHZ -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRUE
#        -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg
#        (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR
#        -DDEFAULT_CHANLIST=0x00000800 -DZDAPP_CONFIG_PAN_ID=0x1223
#        -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MASK=0x007F
#        -DBEACON_REQUEST_DELAY=100 -DBEACON_REQ_DELAY_MASK=0x00FF
#        -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_POLLED=3000
#        -DNWK_INDIRECT_MSG_TIMEOUT=7 -DMAX_RREQ_ENTRIES=8
#        -DAPSC_MAX_FRAME_RETRIES=3 -DNWK_MAX_DATA_RETRIES=2
#        -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9 -DAPS_MAX_GROUPS=16
#        -DMAX_RTG_ENTRIES=40 -DNWK_MAX_BINDING_ENTRIES=4
#        -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01, 0x03, 0x05, 0x07,
#        0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C,
#        0x0D}" -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"
#        -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000
#        -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100
#        -DREJOIN_POLL_RATE=440) -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\ -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\SOURCE\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\ZMAIN\TI2530DB\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\MT\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530EB\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\INCLUDE\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\AF\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\NWK\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SEC\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SYS\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SADDR\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SDATA\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVEL\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\
#        -I
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\
#        -Ohz --require_prototypes)
#    Locale             =  Chinese (Simplified)_CHN.936
#    List file          =  
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\CoordinatorEB-Pro\List\SerialApp.lst
#    Object file        =  
#        D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\CC2530DB\CoordinatorEB-Pro\Obj\SerialApp.r51
#
###############################################################################

D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\Source\SerialApp.c
      1          /*********************************************************************
      2           * INCLUDES
      3           */
      4          #include <stdio.h>
      5          #include <string.h>
      6          #include "AF.h"
      7          #include "OnBoard.h"
      8          #include "OSAL_Tasks.h"
      9          #include "SerialApp.h"
     10          #include "ZDApp.h"
     11          #include "ZDObject.h"
     12          #include "ZDProfile.h"
     13          
     14          #include "hal_drivers.h"
     15          #include "hal_key.h"
     16          #if defined ( LCD_SUPPORTED )
     17            #include "hal_lcd.h"
     18          #endif
     19          #include "hal_led.h"
     20          #include "hal_uart.h"
     21          
     22          /*********************************************************************
     23           * MACROS
     24           */
     25          
     26          /*********************************************************************
     27           * CONSTANTS
     28           */
     29          
     30          #if !defined( SERIAL_APP_PORT )
     31          #define SERIAL_APP_PORT  0
     32          #endif
     33          
     34          #if !defined( SERIAL_APP_BAUD )
     35            //#define SERIAL_APP_BAUD  HAL_UART_BR_38400
     36            #define SERIAL_APP_BAUD  HAL_UART_BR_9600
     37          #endif
     38          
     39          // When the Rx buf space is less than this threshold, invoke the Rx callback.
     40          #if !defined( SERIAL_APP_THRESH )
     41          #define SERIAL_APP_THRESH  64
     42          #endif
     43          
     44          #if !defined( SERIAL_APP_RX_SZ )
     45          #define SERIAL_APP_RX_SZ  128
     46          #endif
     47          
     48          #if !defined( SERIAL_APP_TX_SZ )
     49          #define SERIAL_APP_TX_SZ  128
     50          #endif
     51          
     52          // Millisecs of idle time after a byte is received before invoking Rx callback.
     53          #if !defined( SERIAL_APP_IDLE )
     54          #define SERIAL_APP_IDLE  6
     55          #endif
     56          
     57          // Loopback Rx bytes to Tx for throughput testing.
     58          #if !defined( SERIAL_APP_LOOPBACK )
     59          #define SERIAL_APP_LOOPBACK  FALSE
     60          #endif
     61          
     62          // This is the max byte count per OTA message.
     63          #if !defined( SERIAL_APP_TX_MAX )
     64          #define SERIAL_APP_TX_MAX  80
     65          #endif
     66          
     67          #define SERIAL_APP_RSP_CNT  4
     68          
     69          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
     70          const cId_t SerialApp_ClusterList[SERIALAPP_MAX_CLUSTERS] =
   \                     SerialApp_ClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
   \   000004   0300         DW 3
   \   000006   0400         DW 4
     71          {
     72            SERIALAPP_CLUSTERID1,
     73            SERIALAPP_CLUSTERID2,
     74            SERIALAPP_CONNECTREQ_CLUSTER,            
     75            SERIALAPP_CONNECTRSP_CLUSTER             
     76          };
     77          

   \                                 In  segment XDATA_ROM_C, align 1
     78          const SimpleDescriptionFormat_t SerialApp_SimpleDesc =
   \                     SerialApp_SimpleDesc:
   \   000000   0B           DB 11
   \   000001   050F         DW 3845
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   04           DB 4
   \   000007   ....         DW SerialApp_ClusterList
   \   000009   04           DB 4
   \   00000A   ....         DW SerialApp_ClusterList
     79          {
     80            SERIALAPP_ENDPOINT,              //  int   Endpoint;
     81            SERIALAPP_PROFID,                //  uint16 AppProfId[2];
     82            SERIALAPP_DEVICEID,              //  uint16 AppDeviceId[2];
     83            SERIALAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
     84            SERIALAPP_FLAGS,                 //  int   AppFlags:4;
     85            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
     86            (cId_t *)SerialApp_ClusterList,  //  byte *pAppInClusterList;
     87            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumOutClusters;
     88            (cId_t *)SerialApp_ClusterList   //  byte *pAppOutClusterList;
     89          };
     90          

   \                                 In  segment XDATA_I, align 1, keep-with-next
     91          endPointDesc_t SerialApp_epDesc =
   \                     SerialApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for SerialApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
     92          {
     93            SERIALAPP_ENDPOINT,
     94           &SerialApp_TaskID,
     95            (SimpleDescriptionFormat_t *)&SerialApp_SimpleDesc,
     96            noLatencyReqs
     97          };
     98          
     99          /*********************************************************************
    100           * TYPEDEFS
    101           */
    102          
    103          /*********************************************************************
    104           * GLOBAL VARIABLES
    105           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    106          devStates_t SampleApp_NwkState;   
   \                     SampleApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    107          uint8 SerialApp_TaskID;           // Task ID for internal task/event processing.
   \                     SerialApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    108          
    109          /*********************************************************************
    110           * EXTERNAL VARIABLES
    111           */
    112          
    113          /*********************************************************************
    114           * EXTERNAL FUNCTIONS
    115           */
    116          
    117          /*********************************************************************
    118           * LOCAL VARIABLES
    119           */
    120          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    121          static uint8 SerialApp_MsgID;
   \                     SerialApp_MsgID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    122          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    123          static afAddrType_t SerialApp_TxAddr;
   \                     SerialApp_TxAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    124          static uint8 SerialApp_TxSeq;
   \                     SerialApp_TxSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    125          static uint8 SerialApp_TxBuf[SERIAL_APP_TX_MAX+1];
   \                     SerialApp_TxBuf:
   \   000000                DS 81
   \   000051                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    126          static uint8 SerialApp_TxLen;
   \                     SerialApp_TxLen:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    127          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    128          static afAddrType_t SerialApp_RxAddr;
   \                     SerialApp_RxAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    129          static uint8 SerialApp_RxSeq;
   \                     SerialApp_RxSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    130          static uint8 SerialApp_RspBuf[SERIAL_APP_RSP_CNT];
   \                     SerialApp_RspBuf:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    131          
    132          /*********************************************************************
    133           * LOCAL FUNCTIONS
    134           */
    135          
    136          static void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt );
    137          static void SerialApp_Send(void);
    138          static void SerialApp_Resp(void);
    139          static void SerialApp_CallBack(uint8 port, uint8 event); 
    140          static void SerialApp_DeviceConnect(void);              
    141          static void SerialApp_DeviceConnectRsp(uint8*);         
    142          static void SerialApp_ConnectReqProcess(uint8*);           
    143          
    144          
    145          static void keyInvoke_Send(uint8 key);
    146          static uint8 sendToPc(uint32 addr, uint8 key);
    147          /*********************************************************************
    148           * @fn      SerialApp_Init
    149           *
    150           * @brief   This is called during OSAL tasks' initialization.
    151           *
    152           * @param   task_id - the Task ID assigned by OSAL.
    153           *
    154           * @return  none
    155           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    156          void SerialApp_Init( uint8 task_id )
   \                     SerialApp_Init:
    157          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV       A,#-0x1d
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   E9           MOV       A,R1
   \   00000B   FE           MOV       R6,A
    158            halUARTCfg_t uartConfig;
    159          
    160            SerialApp_TaskID = task_id;
   \   00000C   90....       MOV       DPTR,#SerialApp_TaskID
   \   00000F   F0           MOVX      @DPTR,A
    161            SerialApp_RxSeq = 0xC3;
   \   000010   90....       MOV       DPTR,#SerialApp_RxSeq
   \   000013   74C3         MOV       A,#-0x3d
   \   000015   F0           MOVX      @DPTR,A
    162            SampleApp_NwkState = DEV_INIT;       
   \   000016   90....       MOV       DPTR,#SampleApp_NwkState
   \   000019   7401         MOV       A,#0x1
   \   00001B   F0           MOVX      @DPTR,A
    163            
    164            afRegister( (endPointDesc_t *)&SerialApp_epDesc );
   \   00001C                ; Setup parameters for call to function afRegister
   \   00001C   7A..         MOV       R2,#SerialApp_epDesc & 0xff
   \   00001E   7B..         MOV       R3,#(SerialApp_epDesc >> 8) & 0xff
   \   000020   12....       LCALL     `??afRegister::?relay`; Banked call to: afRegister
    165          
    166            RegisterForKeys( task_id );
   \   000023                ; Setup parameters for call to function RegisterForKeys
   \   000023   EE           MOV       A,R6
   \   000024   F9           MOV       R1,A
   \   000025   12....       LCALL     `??RegisterForKeys::?relay`; Banked call to: RegisterForKeys
    167          
    168            uartConfig.configured           = TRUE;              // 2x30 don't care - see uart driver.
   \   000028   85..82       MOV       DPL,?XSP + 0
   \   00002B   85..83       MOV       DPH,?XSP + 1
   \   00002E   7401         MOV       A,#0x1
   \   000030   F0           MOVX      @DPTR,A
    169            uartConfig.baudRate             = SERIAL_APP_BAUD;
   \   000031   12....       LCALL     ?XSTACK_DISP0_8
   \   000034   E4           CLR       A
   \   000035   F0           MOVX      @DPTR,A
    170            uartConfig.flowControl          = FALSE;
   \   000036   7402         MOV       A,#0x2
   \   000038   12....       LCALL     ?XSTACK_DISP0_8
   \   00003B   E4           CLR       A
   \   00003C   F0           MOVX      @DPTR,A
    171            uartConfig.flowControlThreshold = SERIAL_APP_THRESH; // 2x30 don't care - see uart driver.
   \   00003D   7403         MOV       A,#0x3
   \   00003F   12....       LCALL     ?XSTACK_DISP0_8
   \   000042   7440         MOV       A,#0x40
   \   000044   F0           MOVX      @DPTR,A
   \   000045   A3           INC       DPTR
   \   000046   E4           CLR       A
   \   000047   F0           MOVX      @DPTR,A
    172            uartConfig.rx.maxBufSize        = SERIAL_APP_RX_SZ;  // 2x30 don't care - see uart driver.
   \   000048   740A         MOV       A,#0xa
   \   00004A   12....       LCALL     ?XSTACK_DISP0_8
   \   00004D   7480         MOV       A,#-0x80
   \   00004F   F0           MOVX      @DPTR,A
   \   000050   A3           INC       DPTR
   \   000051   E4           CLR       A
   \   000052   F0           MOVX      @DPTR,A
    173            uartConfig.tx.maxBufSize        = SERIAL_APP_TX_SZ;  // 2x30 don't care - see uart driver.
   \   000053   7412         MOV       A,#0x12
   \   000055   12....       LCALL     ?XSTACK_DISP0_8
   \   000058   7480         MOV       A,#-0x80
   \   00005A   F0           MOVX      @DPTR,A
   \   00005B   A3           INC       DPTR
   \   00005C   E4           CLR       A
   \   00005D   F0           MOVX      @DPTR,A
    174            uartConfig.idleTimeout          = SERIAL_APP_IDLE;   // 2x30 don't care - see uart driver.
   \   00005E   7405         MOV       A,#0x5
   \   000060   12....       LCALL     ?XSTACK_DISP0_8
   \   000063   7406         MOV       A,#0x6
   \   000065   F0           MOVX      @DPTR,A
    175            uartConfig.intEnable            = TRUE;              // 2x30 don't care - see uart driver.
   \   000066   7416         MOV       A,#0x16
   \   000068   12....       LCALL     ?XSTACK_DISP0_8
   \   00006B   7401         MOV       A,#0x1
   \   00006D   F0           MOVX      @DPTR,A
    176            uartConfig.callBackFunc         = SerialApp_CallBack;
   \   00006E   741B         MOV       A,#0x1b
   \   000070   12....       LCALL     ?XSTACK_DISP0_8
   \   000073   74..         MOV       A,#`??SerialApp_CallBack::?relay` & 0xff
   \   000075   F0           MOVX      @DPTR,A
   \   000076   A3           INC       DPTR
   \   000077   74..         MOV       A,#(`??SerialApp_CallBack::?relay` >> 8) & 0xff
   \   000079   F0           MOVX      @DPTR,A
    177            HalUARTOpen (SERIAL_APP_PORT, &uartConfig);
   \   00007A                ; Setup parameters for call to function HalUARTOpen
   \   00007A   AA..         MOV       R2,?XSP + 0
   \   00007C   AB..         MOV       R3,?XSP + 1
   \   00007E   7900         MOV       R1,#0x0
   \   000080   12....       LCALL     `??HalUARTOpen::?relay`; Banked call to: HalUARTOpen
    178          
    179          #if defined ( LCD_SUPPORTED )
    180            HalLcdWriteString( "SerialApp", HAL_LCD_LINE_2 );
   \   000083                ; Setup parameters for call to function HalLcdWriteString
   \   000083   7902         MOV       R1,#0x2
   \   000085   7A..         MOV       R2,#`?<Constant "SerialApp">` & 0xff
   \   000087   7B..         MOV       R3,#(`?<Constant "SerialApp">` >> 8) & 0xff
   \   000089   12....       LCALL     `??HalLcdWriteString::?relay`; Banked call to: HalLcdWriteString
    181          #endif
    182            
    183            ZDO_RegisterForZDOMsg( SerialApp_TaskID, End_Device_Bind_rsp );
   \   00008C                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00008C   7A20         MOV       R2,#0x20
   \   00008E   7B80         MOV       R3,#-0x80
   \   000090   90....       MOV       DPTR,#SerialApp_TaskID
   \   000093   E0           MOVX      A,@DPTR
   \   000094   F9           MOV       R1,A
   \   000095   12....       LCALL     `??ZDO_RegisterForZDOMsg::?relay`; Banked call to: ZDO_RegisterForZDOMsg
    184            ZDO_RegisterForZDOMsg( SerialApp_TaskID, Match_Desc_rsp );
   \   000098                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000098   7A06         MOV       R2,#0x6
   \   00009A   7B80         MOV       R3,#-0x80
   \   00009C   90....       MOV       DPTR,#SerialApp_TaskID
   \   00009F   E0           MOVX      A,@DPTR
   \   0000A0   F9           MOV       R1,A
   \   0000A1   12....       LCALL     `??ZDO_RegisterForZDOMsg::?relay`; Banked call to: ZDO_RegisterForZDOMsg
    185          }
   \   0000A4   741D         MOV       A,#0x1d
   \   0000A6   12....       LCALL     ?DEALLOC_XSTACK8
   \   0000A9                REQUIRE ?Subroutine0
   \   0000A9                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV       R7,#0x1
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    186          
    187          /*********************************************************************
    188           * @fn      SerialApp_ProcessEvent
    189           *
    190           * @brief   Generic Application Task event processor.
    191           *
    192           * @param   task_id  - The OSAL assigned task ID.
    193           * @param   events   - Bit map of events to process.
    194           *
    195           * @return  Event flags of all unprocessed events.
    196           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    197          UINT16 SerialApp_ProcessEvent( uint8 task_id, UINT16 events )
   \                     SerialApp_ProcessEvent:
    198          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
   \   000007   EB           MOV       A,R3
   \   000008   FF           MOV       R7,A
    199            (void)task_id;  // Intentionally unreferenced parameter
    200            uint8 key = 0;
                         ^
Warning[Pe550]: variable "key" was set but never used

  static uint8 SerialApp_RxSeq;
               ^
"D:\SRC\DemoPrj\Projects\zstack\Utilities\SerialApp\Source\SerialApp.c",129  Warning[Pe550]: 
          variable "SerialApp_RxSeq" was set but never used
    201            if ( events & SYS_EVENT_MSG )
   \   000009   5480         ANL       A,#0x80
   \   00000B   701B         JNZ       ??SerialApp_ProcessEvent_0
    202            {
    203              afIncomingMSGPacket_t *MSGpkt;
    204          
    205              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SerialApp_TaskID )) )
    206              {
    207                switch ( MSGpkt->hdr.event )
    208                {
    209                case AF_INCOMING_MSG_CMD:
    210                  SerialApp_ProcessMSGCmd( MSGpkt );
    211                  break;
    212                  
    213                case ZDO_STATE_CHANGE:
    214                  SampleApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    215                  if ( (SampleApp_NwkState == DEV_ZB_COORD)
    216                      || (SampleApp_NwkState == DEV_ROUTER)
    217                      || (SampleApp_NwkState == DEV_END_DEVICE) )
    218                  {
    219                      // Start sending the periodic message in a regular interval.
    220                      //HalLedSet(HAL_LED_1, HAL_LED_MODE_ON);
    221                      
    222                      if(SampleApp_NwkState != DEV_ZB_COORD)
    223                        SerialApp_DeviceConnect();              
    224                  }
    225                  else
    226                  {
    227                    // Device is no longer in the network
    228                  }
    229                  break;
    230                case KEY_CHANGE:
    231                  {
    232                    keyChange_t *keyChangeMsg = (keyChange_t *)MSGpkt;
    233          //          uint8 txbuf[20] = {0};
    234          //          sprintf(txbuf, "hello world, %d\n", keyChangeMsg->keys);
    235          //          HalUARTWrite(SERIAL_APP_PORT, txbuf, strlen(txbuf));
    236                    key = keyChangeMsg->keys;
    237                    keyInvoke_Send(keyChangeMsg->keys);
    238                  }
    239                  break;
    240          
    241                default:
    242                  break;
    243                }
    244          
    245                osal_msg_deallocate( (uint8 *)MSGpkt );
    246              }
    247          
    248              return ( events ^ SYS_EVENT_MSG );
    249            }
    250          
    251            if ( events & SERIALAPP_SEND_EVT )
   \   00000D   EA           MOV       A,R2
   \   00000E   A2E0         MOV       C,0xE0 /* A   */.0
   \   000010   5041         JNC       ??SerialApp_ProcessEvent_1
    252            {
    253              SerialApp_Send();
   \   000012                ; Setup parameters for call to function SerialApp_Send
   \   000012   12....       LCALL     `??SerialApp_Send::?relay`; Banked call to: SerialApp_Send
    254              return ( events ^ SERIALAPP_SEND_EVT );
   \   000015   EE           MOV       A,R6
   \   000016   6401         XRL       A,#0x1
   \   000018   02....       LJMP      ??SerialApp_ProcessEvent_2 & 0xFFFF
    255            }
   \                     ??SerialApp_ProcessEvent_3:
   \   00001B   A3           INC       DPTR
   \   00001C   E0           MOVX      A,@DPTR
   \   00001D   90....       MOV       DPTR,#SampleApp_NwkState
   \   000020   F0           MOVX      @DPTR,A
   \                     ??SerialApp_ProcessEvent_4:
   \   000021                ; Setup parameters for call to function osal_msg_deallocate
   \   000021   AA..         MOV       R2,?V0
   \   000023   AB..         MOV       R3,?V1
   \   000025   12....       LCALL     `??osal_msg_deallocate::?relay`; Banked call to: osal_msg_deallocate
   \                     ??SerialApp_ProcessEvent_0:
   \   000028                ; Setup parameters for call to function osal_msg_receive
   \   000028   90....       MOV       DPTR,#SerialApp_TaskID
   \   00002B   E0           MOVX      A,@DPTR
   \   00002C   F9           MOV       R1,A
   \   00002D   12....       LCALL     `??osal_msg_receive::?relay`; Banked call to: osal_msg_receive
   \   000030   8A..         MOV       ?V0,R2
   \   000032   8B..         MOV       ?V1,R3
   \   000034   EA           MOV       A,R2
   \   000035   4B           ORL       A,R3
   \   000036   6014         JZ        ??SerialApp_ProcessEvent_5
   \   000038   8A82         MOV       DPL,R2
   \   00003A   8B83         MOV       DPH,R3
   \   00003C   E0           MOVX      A,@DPTR
   \   00003D   24E6         ADD       A,#-0x1a
   \   00003F   6006         JZ        ??SerialApp_ProcessEvent_6
   \   000041   2449         ADD       A,#0x49
   \   000043   60D6         JZ        ??SerialApp_ProcessEvent_3
   \   000045   80DA         SJMP      ??SerialApp_ProcessEvent_4
   \                     ??SerialApp_ProcessEvent_6:
   \   000047                ; Setup parameters for call to function SerialApp_ProcessMSGCmd
   \   000047   12....       LCALL     `??SerialApp_ProcessMSGCmd::?relay`; Banked call to: SerialApp_ProcessMSGCmd
   \   00004A   80D5         SJMP      ??SerialApp_ProcessEvent_4
   \                     ??SerialApp_ProcessEvent_5:
   \   00004C   EE           MOV       A,R6
   \   00004D   FA           MOV       R2,A
   \   00004E   EF           MOV       A,R7
   \   00004F   6480         XRL       A,#0x80
   \   000051   8054         SJMP      ??SerialApp_ProcessEvent_7
    256          
    257            if ( events & SERIALAPP_RESP_EVT )
   \                     ??SerialApp_ProcessEvent_1:
   \   000053   5402         ANL       A,#0x2
   \   000055   6053         JZ        ??SerialApp_ProcessEvent_8
    258            {
    259              SerialApp_Resp();
   \   000057                ; Setup parameters for call to function AF_DataRequest
   \   000057   75..1E       MOV       ?V0,#0x1e
   \   00005A   78..         MOV       R0,#?V0
   \   00005C   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00005F   75....       MOV       ?V0,#SerialApp_MsgID & 0xff
   \   000062   75....       MOV       ?V1,#(SerialApp_MsgID >> 8) & 0xff
   \   000065   78..         MOV       R0,#?V0
   \   000067   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00006A   75....       MOV       ?V0,#SerialApp_RspBuf & 0xff
   \   00006D   75....       MOV       ?V1,#(SerialApp_RspBuf >> 8) & 0xff
   \   000070   78..         MOV       R0,#?V0
   \   000072   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000075   75..04       MOV       ?V0,#0x4
   \   000078   75..00       MOV       ?V1,#0x0
   \   00007B   78..         MOV       R0,#?V0
   \   00007D   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000080   75..02       MOV       ?V0,#0x2
   \   000083   78..         MOV       R0,#?V0
   \   000085   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000088   7900         MOV       R1,#0x0
   \   00008A   7C..         MOV       R4,#SerialApp_epDesc & 0xff
   \   00008C   7D..         MOV       R5,#(SerialApp_epDesc >> 8) & 0xff
   \   00008E   7A..         MOV       R2,#SerialApp_RxAddr & 0xff
   \   000090   7B..         MOV       R3,#(SerialApp_RxAddr >> 8) & 0xff
   \   000092   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   000095   7409         MOV       A,#0x9
   \   000097   12....       LCALL     ?DEALLOC_XSTACK8
   \   00009A   E9           MOV       A,R1
   \   00009B   6005         JZ        ??CrossCallReturnLabel_2
   \   00009D                ; Setup parameters for call to function osal_set_event
   \   00009D   7A02         MOV       R2,#0x2
   \   00009F   12....       LCALL     ?Subroutine3 & 0xFFFF
    260              return ( events ^ SERIALAPP_RESP_EVT );
   \                     ??CrossCallReturnLabel_2:
   \   0000A2   EE           MOV       A,R6
   \   0000A3   6402         XRL       A,#0x2
   \                     ??SerialApp_ProcessEvent_2:
   \   0000A5   FA           MOV       R2,A
   \   0000A6   EF           MOV       A,R7
   \                     ??SerialApp_ProcessEvent_7:
   \   0000A7   FB           MOV       R3,A
   \   0000A8   8004         SJMP      ??SerialApp_ProcessEvent_9
    261            }
    262            
    263          
    264            return ( 0 );  // Discard unknown events.
   \                     ??SerialApp_ProcessEvent_8:
   \   0000AA   7A00         MOV       R2,#0x0
   \   0000AC   7B00         MOV       R3,#0x0
   \                     ??SerialApp_ProcessEvent_9:
   \   0000AE                REQUIRE ?Subroutine1
   \   0000AE                ; // Fall through to label ?Subroutine1
    265          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F04         MOV       R7,#0x4
   \   000002   02....       LJMP      ?BANKED_LEAVE_XDATA
    266          
    267          /*********************************************************************
    268           * @fn      SerialApp_ProcessMSGCmd
    269           *
    270           * @brief   Data message processor callback. This function processes
    271           *          any incoming data - probably from other devices. Based
    272           *          on the cluster ID, perform the intended action.
    273           *
    274           * @param   pkt - pointer to the incoming message packet
    275           *
    276           * @return  TRUE if the 'pkt' parameter is being used and will be freed later,
    277           *          FALSE otherwise.
    278           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine4_0:
   \   000000   90....       MOV       DPTR,#SerialApp_TaskID
   \   000003   E0           MOVX      A,@DPTR
   \   000004   F9           MOV       R1,A
   \   000005   12....       LCALL     `??osal_set_event::?relay`; Banked call to: osal_set_event
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    279          void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt )
   \                     SerialApp_ProcessMSGCmd:
    280          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000   74F5         MOV       A,#-0xb
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
    281            uint8 stat;
    282            uint8 seqnb;
    283            uint8 delay;
    284          
    285            switch ( pkt->clusterId )
   \   000005   EA           MOV       A,R2
   \   000006   2421         ADD       A,#0x21
   \   000008   FE           MOV       R6,A
   \   000009   E4           CLR       A
   \   00000A   3B           ADDC      A,R3
   \   00000B   FF           MOV       R7,A
   \   00000C   8A82         MOV       DPL,R2
   \   00000E   8B83         MOV       DPH,R3
   \   000010   A3           INC       DPTR
   \   000011   A3           INC       DPTR
   \   000012   A3           INC       DPTR
   \   000013   A3           INC       DPTR
   \   000014   E0           MOVX      A,@DPTR
   \   000015   F5..         MOV       ?V0,A
   \   000017   A3           INC       DPTR
   \   000018   E0           MOVX      A,@DPTR
   \   000019   F5..         MOV       ?V1,A
   \   00001B   78..         MOV       R0,#?V0
   \   00001D   12....       LCALL     ?US_SWITCH_DENSE
   \                     `?<Jumptable for SerialApp_ProcessMSGCmd>_0`:
   \   000020   0100         DW        1
   \   000022   02           DB        2
   \   000023   ....         DW        ??SerialApp_ProcessMSGCmd_0
   \   000025   ....         DW        ??SerialApp_ProcessMSGCmd_1
   \   000027   ....         DW        ??SerialApp_ProcessMSGCmd_2
   \   000029   ....         DW        ??SerialApp_ProcessMSGCmd_3
    286            {
    287            // A message with a serial data block to be transmitted on the serial port.
    288            case SERIALAPP_CLUSTERID1: //收到发送过来的数据通过串口输出到电脑显示
    289              // Store the address for sending and retrying.
    290              osal_memcpy(&SerialApp_RxAddr, &(pkt->srcAddr), sizeof( afAddrType_t ));
   \                     ??SerialApp_ProcessMSGCmd_1:
   \   00002B                ; Setup parameters for call to function osal_memcpy
   \   00002B   EA           MOV       A,R2
   \   00002C   2406         ADD       A,#0x6
   \   00002E   F5..         MOV       ?V0,A
   \   000030   E4           CLR       A
   \   000031   3B           ADDC      A,R3
   \   000032   F5..         MOV       ?V1,A
   \   000034   75..00       MOV       ?V2,#0x0
   \   000037   78..         MOV       R0,#?V0
   \   000039   12....       LCALL     ?PUSH_XSTACK_I_THREE
   \   00003C   7C0C         MOV       R4,#0xc
   \   00003E   7D00         MOV       R5,#0x0
   \   000040   7A..         MOV       R2,#SerialApp_RxAddr & 0xff
   \   000042   7B..         MOV       R3,#(SerialApp_RxAddr >> 8) & 0xff
   \   000044   12....       LCALL     `??osal_memcpy::?relay`; Banked call to: osal_memcpy
   \   000047   7403         MOV       A,#0x3
   \   000049   12....       LCALL     ?DEALLOC_XSTACK8
    291          
    292              seqnb = pkt->cmd.Data[0];
   \   00004C   8E82         MOV       DPL,R6
   \   00004E   8F83         MOV       DPH,R7
   \   000050   E0           MOVX      A,@DPTR
   \   000051   F8           MOV       R0,A
   \   000052   A3           INC       DPTR
   \   000053   E0           MOVX      A,@DPTR
   \   000054   8882         MOV       DPL,R0
   \   000056   F583         MOV       DPH,A
   \   000058   E0           MOVX      A,@DPTR
   \   000059   FE           MOV       R6,A
    293              
    294          //    HalUARTWrite( SERIAL_APP_PORT, pkt->cmd.Data+1, (pkt->cmd.DataLength-1));
    295                           
    296              // Keep message if not a repeat packet
    297          //    if ( (seqnb > SerialApp_RxSeq) ||                    // Normal
    298          //        ((seqnb < 0x80 ) && ( SerialApp_RxSeq > 0x80)) ) // Wrap-around
    299                if(1)
    300              {
    301                  // Transmit the data on the serial port. // 通过串口发送数据到PC机
    302          #if ZDO_COORDINATOR
    303                  if(sendToPc(0x0001, pkt->cmd.Data[1]))  
   \   00005A                ; Setup parameters for call to function sendToPc
   \   00005A   A3           INC       DPTR
   \   00005B   E0           MOVX      A,@DPTR
   \   00005C   F9           MOV       R1,A
   \   00005D   90....       MOV       DPTR,#__Constant_1
   \   000060   12....       LCALL     ?XLOAD_R2345
   \   000063   12....       LCALL     `??sendToPc::?relay`; Banked call to: sendToPc
   \   000066   E9           MOV       A,R1
   \   000067   600B         JZ        ??SerialApp_ProcessMSGCmd_4
    304          #else           
    305                  if ( HalUARTWrite( SERIAL_APP_PORT, pkt->cmd.Data+1, (pkt->cmd.DataLength-1) ) )
    306          #endif          
    307                  {
    308                    // Save for next incoming message
    309                    SerialApp_RxSeq = seqnb;
   \   000069   EE           MOV       A,R6
   \   00006A   90....       MOV       DPTR,#SerialApp_RxSeq
   \   00006D   F0           MOVX      @DPTR,A
    310                    stat = OTA_SUCCESS;
   \   00006E   7400         MOV       A,#0x0
   \   000070   7801         MOV       R0,#0x1
   \   000072   8004         SJMP      ??SerialApp_ProcessMSGCmd_5
    311                  }
    312                  else
    313                  {
    314                    stat = OTA_SER_BUSY;
   \                     ??SerialApp_ProcessMSGCmd_4:
   \   000074   7402         MOV       A,#0x2
   \   000076   7810         MOV       R0,#0x10
    315                  }
    316              }
    317              else
    318              {
    319                  stat = OTA_DUP_MSG;
    320              }
    321          
    322              // Select approproiate OTA flow-control delay.
    323              delay = (stat == OTA_SER_BUSY) ? SERIALAPP_NAK_DELAY : SERIALAPP_ACK_DELAY;
    324          
    325              // Build & send OTA response message.
    326              SerialApp_RspBuf[0] = stat;
   \                     ??SerialApp_ProcessMSGCmd_5:
   \   000078   90....       MOV       DPTR,#SerialApp_RspBuf
   \   00007B   F0           MOVX      @DPTR,A
    327              SerialApp_RspBuf[1] = seqnb;
   \   00007C   EE           MOV       A,R6
   \   00007D   A3           INC       DPTR
   \   00007E   F0           MOVX      @DPTR,A
    328              SerialApp_RspBuf[2] = LO_UINT16( delay );
   \   00007F   E8           MOV       A,R0
   \   000080   A3           INC       DPTR
   \   000081   F0           MOVX      @DPTR,A
    329              SerialApp_RspBuf[3] = HI_UINT16( delay );
   \   000082   A3           INC       DPTR
   \   000083   E4           CLR       A
   \   000084   F0           MOVX      @DPTR,A
    330              osal_set_event( SerialApp_TaskID, SERIALAPP_RESP_EVT ); //收到数据后，发送一个响应事件
   \   000085                ; Setup parameters for call to function osal_set_event
   \   000085   7A02         MOV       R2,#0x2
   \   000087   FB           MOV       R3,A
   \   000088   12....       LCALL     ??Subroutine4_0 & 0xFFFF
    331              osal_stop_timerEx(SerialApp_TaskID, SERIALAPP_RESP_EVT);
   \                     ??CrossCallReturnLabel_4:
   \   00008B                ; Setup parameters for call to function osal_stop_timerEx
   \   00008B   7A02         MOV       R2,#0x2
   \   00008D   7B00         MOV       R3,#0x0
   \   00008F   8008         SJMP      ??SerialApp_ProcessMSGCmd_6
    332              break;
    333          
    334            // A response to a received serial data block.   // 接到响应消息
    335            case SERIALAPP_CLUSTERID2:
    336              if(1)
    337          //    if ((pkt->cmd.Data[1] == SerialApp_TxSeq) &&
    338          //       ((pkt->cmd.Data[0] == OTA_SUCCESS) || (pkt->cmd.Data[0] == OTA_DUP_MSG)))
    339              {
    340                SerialApp_TxLen = 0;
   \                     ??SerialApp_ProcessMSGCmd_2:
   \   000091   90....       MOV       DPTR,#SerialApp_TxLen
   \   000094   E4           CLR       A
   \   000095   F0           MOVX      @DPTR,A
    341                osal_stop_timerEx(SerialApp_TaskID, SERIALAPP_SEND_EVT);
   \   000096                ; Setup parameters for call to function osal_stop_timerEx
   \   000096   7A01         MOV       R2,#0x1
   \   000098   FB           MOV       R3,A
   \                     ??SerialApp_ProcessMSGCmd_6:
   \   000099   90....       MOV       DPTR,#SerialApp_TaskID
   \   00009C   E0           MOVX      A,@DPTR
   \   00009D   F9           MOV       R1,A
   \   00009E   12....       LCALL     `??osal_stop_timerEx::?relay`; Banked call to: osal_stop_timerEx
    342              }
    343              else
    344              {
    345                // Re-start timeout according to delay sent from other device.
    346                delay = BUILD_UINT16( pkt->cmd.Data[2], pkt->cmd.Data[3] );
    347                osal_start_timerEx( SerialApp_TaskID, SERIALAPP_SEND_EVT, delay );
    348              }
    349              break;
   \   0000A1   800C         SJMP      ??SerialApp_ProcessMSGCmd_0
    350          
    351              case SERIALAPP_CONNECTREQ_CLUSTER:
    352                SerialApp_ConnectReqProcess((uint8*)pkt->cmd.Data);
   \                     ??SerialApp_ProcessMSGCmd_3:
   \   0000A3                ; Setup parameters for call to function SerialApp_ConnectReqProcess
   \   0000A3   8E82         MOV       DPL,R6
   \   0000A5   8F83         MOV       DPH,R7
   \   0000A7   E0           MOVX      A,@DPTR
   \   0000A8   FA           MOV       R2,A
   \   0000A9   A3           INC       DPTR
   \   0000AA   E0           MOVX      A,@DPTR
   \   0000AB   FB           MOV       R3,A
   \   0000AC   12....       LCALL     `??SerialApp_ConnectReqProcess::?relay`; Banked call to: SerialApp_ConnectReqProcess
    353                
    354              case SERIALAPP_CONNECTRSP_CLUSTER:
    355                SerialApp_DeviceConnectRsp((uint8*)pkt->cmd.Data);
    356                
    357              default:
    358                break;
    359            }
    360          }
   \                     ??SerialApp_ProcessMSGCmd_0:
   \   0000AF   7F03         MOV       R7,#0x3
   \   0000B1   02....       LJMP      ?BANKED_LEAVE_XDATA
    361          
    362          /*********************************************************************
    363           * @fn      SerialApp_Send
    364           *
    365           * @brief   Send data OTA.
    366           *
    367           * @param   none
    368           *
    369           * @return  none
    370           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7B00         MOV       R3,#0x0
   \   000002                REQUIRE ??Subroutine4_0
   \   000002                ; // Fall through to label ??Subroutine4_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    371          static void SerialApp_Send(void)
   \                     SerialApp_Send:
    372          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV       A,#-0xa
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    373          #if SERIAL_APP_LOOPBACK
    374              if (SerialApp_TxLen < SERIAL_APP_TX_MAX)
    375              {
    376                  SerialApp_TxLen += HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf+SerialApp_TxLen+1,
    377                                                                SERIAL_APP_TX_MAX-SerialApp_TxLen);
    378              }
    379            
    380              if (SerialApp_TxLen)
    381              {
    382                (void)SerialApp_TxAddr;
    383                if (HalUARTWrite(SERIAL_APP_PORT, SerialApp_TxBuf+1, SerialApp_TxLen))
    384                {
    385                  SerialApp_TxLen = 0;
    386                }
    387                else
    388                {
    389                  osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
    390                }
    391              }
    392          #else
    393              if (!SerialApp_TxLen && 
    394                  (SerialApp_TxLen = HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf+1, SERIAL_APP_TX_MAX)))
   \   000005   90....       MOV       DPTR,#SerialApp_TxLen
   \   000008   E0           MOVX      A,@DPTR
   \   000009   701E         JNZ       ??SerialApp_Send_0
   \   00000B                ; Setup parameters for call to function HalUARTRead
   \   00000B   7C50         MOV       R4,#0x50
   \   00000D   7D00         MOV       R5,#0x0
   \   00000F   7A..         MOV       R2,#(SerialApp_TxBuf + 1) & 0xff
   \   000011   7B..         MOV       R3,#((SerialApp_TxBuf + 1) >> 8) & 0xff
   \   000013   7900         MOV       R1,#0x0
   \   000015   12....       LCALL     `??HalUARTRead::?relay`; Banked call to: HalUARTRead
   \   000018   EA           MOV       A,R2
   \   000019   90....       MOV       DPTR,#SerialApp_TxLen
   \   00001C   F0           MOVX      @DPTR,A
   \   00001D   605F         JZ        ??CrossCallReturnLabel_3
    395              {
    396                // Pre-pend sequence number to the Tx message.
    397                SerialApp_TxBuf[0] = ++SerialApp_TxSeq;
   \   00001F   90....       MOV       DPTR,#SerialApp_TxSeq
   \   000022   E0           MOVX      A,@DPTR
   \   000023   04           INC       A
   \   000024   F0           MOVX      @DPTR,A
   \   000025   90....       MOV       DPTR,#SerialApp_TxBuf
   \   000028   F0           MOVX      @DPTR,A
    398              }
    399            
    400              if (SerialApp_TxLen)
    401              {
    402                if (afStatus_SUCCESS != AF_DataRequest(&SerialApp_TxAddr,
    403                                                       (endPointDesc_t *)&SerialApp_epDesc,
    404                                                        SERIALAPP_CLUSTERID1,
    405                                                        SerialApp_TxLen+1, SerialApp_TxBuf,
    406                                                        &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
   \                     ??SerialApp_Send_0:
   \   000029                ; Setup parameters for call to function AF_DataRequest
   \   000029   75..1E       MOV       ?V0,#0x1e
   \   00002C   78..         MOV       R0,#?V0
   \   00002E   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000031   75....       MOV       ?V0,#SerialApp_MsgID & 0xff
   \   000034   75....       MOV       ?V1,#(SerialApp_MsgID >> 8) & 0xff
   \   000037   78..         MOV       R0,#?V0
   \   000039   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00003C   75....       MOV       ?V0,#SerialApp_TxBuf & 0xff
   \   00003F   75....       MOV       ?V1,#(SerialApp_TxBuf >> 8) & 0xff
   \   000042   78..         MOV       R0,#?V0
   \   000044   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000047   90....       MOV       DPTR,#SerialApp_TxLen
   \   00004A   E0           MOVX      A,@DPTR
   \   00004B   2401         ADD       A,#0x1
   \   00004D   F5..         MOV       ?V0,A
   \   00004F   E4           CLR       A
   \   000050   3400         ADDC      A,#0x0
   \   000052   F5..         MOV       ?V1,A
   \   000054   78..         MOV       R0,#?V0
   \   000056   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000059   75..01       MOV       ?V0,#0x1
   \   00005C   75..00       MOV       ?V1,#0x0
   \   00005F   78..         MOV       R0,#?V0
   \   000061   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000064   7900         MOV       R1,#0x0
   \   000066   7C..         MOV       R4,#SerialApp_epDesc & 0xff
   \   000068   7D..         MOV       R5,#(SerialApp_epDesc >> 8) & 0xff
   \   00006A   7A..         MOV       R2,#SerialApp_TxAddr & 0xff
   \   00006C   7B..         MOV       R3,#(SerialApp_TxAddr >> 8) & 0xff
   \   00006E   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   000071   7409         MOV       A,#0x9
   \   000073   12....       LCALL     ?DEALLOC_XSTACK8
   \   000076   E9           MOV       A,R1
   \   000077   6005         JZ        ??CrossCallReturnLabel_3
    407                {
    408                  osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
   \   000079                ; Setup parameters for call to function osal_set_event
   \   000079   7A01         MOV       R2,#0x1
   \   00007B   12....       LCALL     ?Subroutine3 & 0xFFFF
    409                }
    410              }
    411          #endif
    412          }
   \                     ??CrossCallReturnLabel_3:
   \   00007E   7F02         MOV       R7,#0x2
   \   000080   02....       LJMP      ?BANKED_LEAVE_XDATA
    413          
    414          /*********************************************************************
    415           * @fn      SerialApp_Resp
    416           *
    417           * @brief   Send data OTA.
    418           *
    419           * @param   none
    420           *
    421           * @return  none
    422           */
    423          static void SerialApp_Resp(void)
    424          {
    425            if (afStatus_SUCCESS != AF_DataRequest(&SerialApp_RxAddr,
    426                                                   (endPointDesc_t *)&SerialApp_epDesc,
    427                                                    SERIALAPP_CLUSTERID2,
    428                                                    SERIAL_APP_RSP_CNT, SerialApp_RspBuf,
    429                                                   &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
    430            {
    431              osal_set_event(SerialApp_TaskID, SERIALAPP_RESP_EVT);
    432            }
    433          }
    434          
    435          /*********************************************************************
    436           * @fn      SerialApp_CallBack
    437           *
    438           * @brief   Send data OTA.
    439           *
    440           * @param   port - UART port.
    441           * @param   event - the UART port event flag.
    442           *
    443           * @return  none
    444           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    445          static void SerialApp_CallBack(uint8 port, uint8 event)
   \                     SerialApp_CallBack:
    446          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV       A,R2
   \   000006   FE           MOV       R6,A
    447            (void)port;
    448          
    449            if ((event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT)) &&
    450          #if SERIAL_APP_LOOPBACK
    451                (SerialApp_TxLen < SERIAL_APP_TX_MAX))
    452          #else
    453                !SerialApp_TxLen)
   \   000007   7407         MOV       A,#0x7
   \   000009   5E           ANL       A,R6
   \   00000A   6009         JZ        ??SerialApp_CallBack_0
   \   00000C   90....       MOV       DPTR,#SerialApp_TxLen
   \   00000F   E0           MOVX      A,@DPTR
   \   000010   7003         JNZ       ??SerialApp_CallBack_0
    454          #endif
    455            {
    456              SerialApp_Send();
   \   000012                ; Setup parameters for call to function SerialApp_Send
   \   000012   12....       LCALL     `??SerialApp_Send::?relay`; Banked call to: SerialApp_Send
    457            }
    458          }
   \                     ??SerialApp_CallBack_0:
   \   000015   02....       LJMP      ?Subroutine0 & 0xFFFF
    459          
    460          /*********************************************************************
    461          *********************************************************************/
    462          void  SerialApp_DeviceConnect()              
    463          {
    464          #if ZDO_COORDINATOR
    465            
    466          #else
    467            
    468            uint16 nwkAddr;
    469            uint16 parentNwkAddr;
    470            char buff[30] = {0};
    471            
    472            HalLedBlink( HAL_LED_2, 3, 50, (1000 / 4) );
    473            
    474            nwkAddr = NLME_GetShortAddr();
    475            parentNwkAddr = NLME_GetCoordShortAddr();
    476            sprintf(buff, "parent:%d   self:%d\r\n", parentNwkAddr, nwkAddr);
    477            HalUARTWrite ( 0, (uint8*)buff, strlen(buff));
    478            
    479            SerialApp_TxAddr.addrMode = (afAddrMode_t)Addr16Bit;
    480            SerialApp_TxAddr.endPoint = SERIALAPP_ENDPOINT;
    481            SerialApp_TxAddr.addr.shortAddr = parentNwkAddr;
    482            
    483            buff[0] = HI_UINT16( nwkAddr );
    484            buff[1] = LO_UINT16( nwkAddr );
    485            
    486            if ( AF_DataRequest( &SerialApp_TxAddr, &SerialApp_epDesc,
    487                                 SERIALAPP_CONNECTREQ_CLUSTER,
    488                                 2,
    489                                 (uint8*)buff,
    490                                 &SerialApp_MsgID, 
    491                                 0, 
    492                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    493            {
    494            }
    495            else
    496            {
    497              // Error occurred in request to send.
    498            }
    499            
    500          #endif    //ZDO_COORDINATOR
    501          }
    502          
    503          void SerialApp_DeviceConnectRsp(uint8 *buf)
    504          {
    505          #if ZDO_COORDINATOR
    506            
    507          #else
    508            SerialApp_TxAddr.addrMode = (afAddrMode_t)Addr16Bit;
    509            SerialApp_TxAddr.endPoint = SERIALAPP_ENDPOINT;
    510            SerialApp_TxAddr.addr.shortAddr = BUILD_UINT16(buf[1], buf[0]);
    511            
    512            //HalLedSet(HAL_LED_2, HAL_LED_MODE_OFF);
    513            //HalLedSet(HAL_LED_2, HAL_LED_MODE_ON);
    514            HalUARTWrite ( 0, "< connect success>\n", 23);
    515            //HalLedSet (HAL_LED_ALL, HAL_LED_MODE_OFF);
    516          #endif
    517          }
    518          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    519          void SerialApp_ConnectReqProcess(uint8 *buf)
   \                     SerialApp_ConnectReqProcess:
    520          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV       A,#-0xc
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 30
   \   000005   74E2         MOV       A,#-0x1e
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
    521            uint16 nwkAddr;
    522            char buff[30] = {0};
   \   00000A   90....       MOV       DPTR,#`?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0`
   \   00000D   AC..         MOV       R4,?XSP + 0
   \   00000F   AD..         MOV       R5,?XSP + 1
   \   000011   741E         MOV       A,#0x1e
   \   000013   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    523            
    524            SerialApp_TxAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000016   90....       MOV       DPTR,#SerialApp_TxAddr + 8
   \   000019   7402         MOV       A,#0x2
   \   00001B   F0           MOVX      @DPTR,A
    525            SerialApp_TxAddr.endPoint = SERIALAPP_ENDPOINT;
   \   00001C   A3           INC       DPTR
   \   00001D   740B         MOV       A,#0xb
   \   00001F   F0           MOVX      @DPTR,A
    526            SerialApp_TxAddr.addr.shortAddr = BUILD_UINT16(buf[1], buf[0]);
   \   000020   8A82         MOV       DPL,R2
   \   000022   8B83         MOV       DPH,R3
   \   000024   A3           INC       DPTR
   \   000025   E0           MOVX      A,@DPTR
   \   000026   FC           MOV       R4,A
   \   000027   8A82         MOV       DPL,R2
   \   000029   8B83         MOV       DPH,R3
   \   00002B   E0           MOVX      A,@DPTR
   \   00002C   F9           MOV       R1,A
   \   00002D   EC           MOV       A,R4
   \   00002E   90....       MOV       DPTR,#SerialApp_TxAddr
   \   000031   F0           MOVX      @DPTR,A
   \   000032   A3           INC       DPTR
   \   000033   E9           MOV       A,R1
   \   000034   F0           MOVX      @DPTR,A
    527            nwkAddr = NLME_GetShortAddr();
   \   000035                ; Setup parameters for call to function NLME_GetShortAddr
   \   000035   12....       LCALL     `??NLME_GetShortAddr::?relay`; Banked call to: NLME_GetShortAddr
   \   000038   8A..         MOV       ?V0,R2
   \   00003A   8B..         MOV       ?V1,R3
    528            
    529            sprintf(buff, "self:%d   child:%d\r\n", nwkAddr, SerialApp_TxAddr.addr.shortAddr);
   \   00003C                ; Setup parameters for call to function sprintf
   \   00003C   90....       MOV       DPTR,#SerialApp_TxAddr
   \   00003F   12....       LCALL     ?PUSH_XSTACK8_X_TWO
   \   000042   78..         MOV       R0,#?V0
   \   000044   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000047   7C..         MOV       R4,#`?<Constant "self:%d   child:%d\\r\\n">` & 0xff
   \   000049   7D..         MOV       R5,#(`?<Constant "self:%d   child:%d\\r\\n">` >> 8) & 0xff
   \   00004B   7404         MOV       A,#0x4
   \   00004D   12....       LCALL     ?XSTACK_DISP101_8
   \   000050   12....       LCALL     `??sprintf::?relay`; Banked call to: sprintf
   \   000053   7404         MOV       A,#0x4
   \   000055   12....       LCALL     ?DEALLOC_XSTACK8
    530            HalUARTWrite ( 0, (uint8*)buff, strlen(buff));
   \   000058                ; Setup parameters for call to function strlen
   \   000058   AA..         MOV       R2,?XSP + 0
   \   00005A   AB..         MOV       R3,?XSP + 1
   \   00005C   12....       LCALL     `??strlen::?relay`; Banked call to: strlen
   \   00005F   8A..         MOV       ?V2,R2
   \   000061   8B..         MOV       ?V3,R3
   \   000063   AC..         MOV       R4,?V2
   \   000065   AD..         MOV       R5,?V3
   \   000067                ; Setup parameters for call to function HalUARTWrite
   \   000067   AA..         MOV       R2,?XSP + 0
   \   000069   AB..         MOV       R3,?XSP + 1
   \   00006B   7900         MOV       R1,#0x0
   \   00006D   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    531            
    532            buff[0] = HI_UINT16( nwkAddr );
   \   000070   85..82       MOV       DPL,?XSP + 0
   \   000073   85..83       MOV       DPH,?XSP + 1
   \   000076   E5..         MOV       A,?V1
   \   000078   F0           MOVX      @DPTR,A
    533            buff[1] = LO_UINT16( nwkAddr );
   \   000079   7401         MOV       A,#0x1
   \   00007B   12....       LCALL     ?XSTACK_DISP0_8
   \   00007E   E5..         MOV       A,?V0
   \   000080   F0           MOVX      @DPTR,A
    534            
    535            if ( AF_DataRequest( &SerialApp_TxAddr, &SerialApp_epDesc,
    536                                 SERIALAPP_CONNECTRSP_CLUSTER,
    537                                 2,
    538                                 (uint8*)buff,
    539                                 &SerialApp_MsgID, 
    540                                 0, 
    541                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000081                ; Setup parameters for call to function AF_DataRequest
   \   000081   75..1E       MOV       ?V0,#0x1e
   \   000084   78..         MOV       R0,#?V0
   \   000086   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000089   75....       MOV       ?V0,#SerialApp_MsgID & 0xff
   \   00008C   75....       MOV       ?V1,#(SerialApp_MsgID >> 8) & 0xff
   \   00008F   78..         MOV       R0,#?V0
   \   000091   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000094   7403         MOV       A,#0x3
   \   000096   12....       LCALL     ?XSTACK_DISP100_8
   \   000099   88..         MOV       ?V0,R0
   \   00009B   89..         MOV       ?V1,R1
   \   00009D   78..         MOV       R0,#?V0
   \   00009F   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000A2   75..02       MOV       ?V0,#0x2
   \   0000A5   75..00       MOV       ?V1,#0x0
   \   0000A8   78..         MOV       R0,#?V0
   \   0000AA   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000AD   75..04       MOV       ?V0,#0x4
   \   0000B0   78..         MOV       R0,#?V0
   \   0000B2   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000B5   7900         MOV       R1,#0x0
   \   0000B7   7C..         MOV       R4,#SerialApp_epDesc & 0xff
   \   0000B9   7D..         MOV       R5,#(SerialApp_epDesc >> 8) & 0xff
   \   0000BB   7A..         MOV       R2,#SerialApp_TxAddr & 0xff
   \   0000BD   7B..         MOV       R3,#(SerialApp_TxAddr >> 8) & 0xff
   \   0000BF   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   0000C2   7409         MOV       A,#0x9
   \   0000C4   12....       LCALL     ?DEALLOC_XSTACK8
    542            {
    543            }
    544            else
    545            {
    546              // Error occurred in request to send.
    547            }
    548            
    549            //HalLedSet(HAL_LED_2, HAL_LED_MODE_ON);
    550            HalUARTWrite ( 0, "< connect success>\n", 23);
   \   0000C7                ; Setup parameters for call to function HalUARTWrite
   \   0000C7   7C17         MOV       R4,#0x17
   \   0000C9   7D00         MOV       R5,#0x0
   \   0000CB   7A..         MOV       R2,#`?<Constant "< connect success>\\n">` & 0xff
   \   0000CD   7B..         MOV       R3,#(`?<Constant "< connect success>\\n">` >> 8) & 0xff
   \   0000CF   7900         MOV       R1,#0x0
   \   0000D1   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    551            //HalLedSet (HAL_LED_ALL, HAL_LED_MODE_ON);
    552          }
   \   0000D4   741E         MOV       A,#0x1e
   \   0000D6   12....       LCALL     ?DEALLOC_XSTACK8
   \   0000D9   02....       LJMP      ?Subroutine1 & 0xFFFF
    553          
    554          
    555          
    556          /*********************************************************************
    557           * @fn      SerialApp_Send
    558           *
    559           * @brief   Send data OTA.
    560           *
    561           * @param   none
    562           *
    563           * @return  none
    564           */
    565          static void keyInvoke_Send(uint8 key)
    566          { 
    567          #if ZDO_COORDINATOR
    568            
    569          #else  
    570              SerialApp_TxBuf[1] = key;
    571              SerialApp_TxLen = 1;
    572              if (SerialApp_TxLen)
    573              {
    574                SerialApp_TxBuf[0] = ++SerialApp_TxSeq;
    575                if (afStatus_SUCCESS != AF_DataRequest(&SerialApp_TxAddr,
    576                                                       (endPointDesc_t *)&SerialApp_epDesc,
    577                                                        SERIALAPP_CLUSTERID1,
    578                                                        SerialApp_TxLen+1, SerialApp_TxBuf,
    579                                                        &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
    580                {
    581                  HalUARTWrite ( 0, "send failed\n", 12);
    582                }
    583                SerialApp_TxLen = 0;
    584              }
    585          #endif
    586          }
    587          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    588          static uint8 sendToPc(uint32 addr, uint8 key){
   \                     sendToPc:
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000   74F0         MOV       A,#-0x10
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 20
   \   000005   74EC         MOV       A,#-0x14
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   8C..         MOV       ?V2,R4
   \   00000C   8D..         MOV       ?V3,R5
   \   00000E   E9           MOV       A,R1
   \   00000F   FE           MOV       R6,A
    589          #if ZDO_COORDINATOR
    590            uint8 txbuf[20] = {0};
   \   000010   90....       MOV       DPTR,#`?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0_1`
   \   000013   AC..         MOV       R4,?XSP + 0
   \   000015   AD..         MOV       R5,?XSP + 1
   \   000017   7414         MOV       A,#0x14
   \   000019   12....       LCALL     ?MOVE_LONG8_XDATA_XDATA
    591            txbuf[0] = 0xA0;
   \   00001C   85..82       MOV       DPL,?XSP + 0
   \   00001F   85..83       MOV       DPH,?XSP + 1
   \   000022   74A0         MOV       A,#-0x60
   \   000024   F0           MOVX      @DPTR,A
    592            txbuf[1] = 0xB0;
   \   000025   7401         MOV       A,#0x1
   \   000027   12....       LCALL     ?XSTACK_DISP0_8
   \   00002A   74B0         MOV       A,#-0x50
   \   00002C   F0           MOVX      @DPTR,A
    593            txbuf[2] = 1;
   \   00002D   7402         MOV       A,#0x2
   \   00002F   12....       LCALL     ?XSTACK_DISP0_8
   \   000032   7401         MOV       A,#0x1
   \   000034   12....       LCALL     ?Subroutine2 & 0xFFFF
    594            txbuf[3] = (addr >> 24)&0xFF;
   \                     ??CrossCallReturnLabel_0:
   \   000037   85....       MOV       ?V7,?V3
   \   00003A   7418         MOV       A,#0x18
   \   00003C   78..         MOV       R0,#?V4
   \   00003E   12....       LCALL     ?UL_SHR
   \   000041   7403         MOV       A,#0x3
   \   000043   12....       LCALL     ?XSTACK_DISP0_8
   \   000046   E5..         MOV       A,?V4
   \   000048   12....       LCALL     ?Subroutine2 & 0xFFFF
    595            txbuf[4] = (addr >> 16)&0xFF;
   \                     ??CrossCallReturnLabel_1:
   \   00004B   F5..         MOV       ?V7,A
   \   00004D   7410         MOV       A,#0x10
   \   00004F   78..         MOV       R0,#?V4
   \   000051   12....       LCALL     ?UL_SHR
   \   000054   7404         MOV       A,#0x4
   \   000056   12....       LCALL     ?XSTACK_DISP0_8
   \   000059   E5..         MOV       A,?V4
   \   00005B   F0           MOVX      @DPTR,A
    596            txbuf[5] = (addr >> 8)&0xFF;
   \   00005C   7405         MOV       A,#0x5
   \   00005E   12....       LCALL     ?XSTACK_DISP0_8
   \   000061   EB           MOV       A,R3
   \   000062   F0           MOVX      @DPTR,A
    597            txbuf[6] = (addr >> 0)&0xFF;
   \   000063   7406         MOV       A,#0x6
   \   000065   12....       LCALL     ?XSTACK_DISP0_8
   \   000068   EA           MOV       A,R2
   \   000069   F0           MOVX      @DPTR,A
    598            if(key == HAL_KEY_SW_1){
   \   00006A   7401         MOV       A,#0x1
   \   00006C   6E           XRL       A,R6
   \   00006D   7021         JNZ       ??sendToPc_0
    599              txbuf[7] = 'A';
   \   00006F   7407         MOV       A,#0x7
   \   000071   12....       LCALL     ?XSTACK_DISP0_8
   \   000074   7441         MOV       A,#0x41
   \                     ??sendToPc_1:
   \   000076   F0           MOVX      @DPTR,A
    600            }else if(key == HAL_KEY_SW_2){
    601              txbuf[7] = 'B';
    602            }else if(key == HAL_KEY_SW_3){
    603              txbuf[7] = 'C';
    604            }else if(key == HAL_KEY_SW_4){
    605              txbuf[7] = 'D';
    606            }else if(key == HAL_KEY_SW_5){
    607              txbuf[7] = 'E';
    608            }else{
    609              return 1;
    610            }
    611          
    612            //txbuf[7] = key;
    613            HalUARTWrite ( 0, txbuf, 8);
   \   000077                ; Setup parameters for call to function HalUARTWrite
   \   000077   7C08         MOV       R4,#0x8
   \   000079   7D00         MOV       R5,#0x0
   \   00007B   AA..         MOV       R2,?XSP + 0
   \   00007D   AB..         MOV       R3,?XSP + 1
   \   00007F   7900         MOV       R1,#0x0
   \   000081   12....       LCALL     `??HalUARTWrite::?relay`; Banked call to: HalUARTWrite
    614            return 1;
   \                     ??sendToPc_2:
   \   000084   7901         MOV       R1,#0x1
   \   000086   7414         MOV       A,#0x14
   \   000088   12....       LCALL     ?DEALLOC_XSTACK8
   \   00008B   7F08         MOV       R7,#0x8
   \   00008D   02....       LJMP      ?BANKED_LEAVE_XDATA
   \                     ??sendToPc_0:
   \   000090   7402         MOV       A,#0x2
   \   000092   6E           XRL       A,R6
   \   000093   7009         JNZ       ??sendToPc_3
   \   000095   7407         MOV       A,#0x7
   \   000097   12....       LCALL     ?XSTACK_DISP0_8
   \   00009A   7442         MOV       A,#0x42
   \   00009C   80D8         SJMP      ??sendToPc_1
   \                     ??sendToPc_3:
   \   00009E   7410         MOV       A,#0x10
   \   0000A0   6E           XRL       A,R6
   \   0000A1   7009         JNZ       ??sendToPc_4
   \   0000A3   7407         MOV       A,#0x7
   \   0000A5   12....       LCALL     ?XSTACK_DISP0_8
   \   0000A8   7443         MOV       A,#0x43
   \   0000AA   80CA         SJMP      ??sendToPc_1
   \                     ??sendToPc_4:
   \   0000AC   7408         MOV       A,#0x8
   \   0000AE   6E           XRL       A,R6
   \   0000AF   7009         JNZ       ??sendToPc_5
   \   0000B1   7407         MOV       A,#0x7
   \   0000B3   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B6   7444         MOV       A,#0x44
   \   0000B8   80BC         SJMP      ??sendToPc_1
   \                     ??sendToPc_5:
   \   0000BA   7404         MOV       A,#0x4
   \   0000BC   6E           XRL       A,R6
   \   0000BD   70C5         JNZ       ??sendToPc_2
   \   0000BF   7407         MOV       A,#0x7
   \   0000C1   12....       LCALL     ?XSTACK_DISP0_8
   \   0000C4   7445         MOV       A,#0x45
   \   0000C6   80AE         SJMP      ??sendToPc_1
    615          #else  
    616          
    617          #endif
    618          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   F0           MOVX      @DPTR,A
   \   000001   8A..         MOV       ?V4,R2
   \   000003   8B..         MOV       ?V5,R3
   \   000005   85....       MOV       ?V6,?V2
   \   000008   22           RET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for SerialApp_epDesc>`:
   \   000000   0B           DB 11
   \   000001   ....         DW SerialApp_TaskID
   \   000003   ....         DW SerialApp_SimpleDesc
   \   000005   00           DB 0

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SerialApp_Init::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SerialApp_ProcessEvent::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SerialApp_ProcessMSGCmd::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessMSGCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SerialApp_Send::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_Send

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SerialApp_CallBack::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_CallBack

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??SerialApp_ConnectReqProcess::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ConnectReqProcess

   \                                 In  segment BANK_RELAYS, align 1
   \                     `??sendToPc::?relay`:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    sendToPc

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "SerialApp">`:
   \   000000   53657269     DB "SerialApp"
   \            616C4170
   \            7000    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0`:
   \   000000   00           DB 0
   \   000001   00           DB 0
   \   000002   00           DB 0
   \   000003   00           DB 0
   \   000004   00           DB 0
   \   000005   00           DB 0
   \   000006   00           DB 0
   \   000007   00           DB 0
   \   000008   00           DB 0
   \   000009   00           DB 0
   \   00000A   00           DB 0
   \   00000B   00           DB 0
   \   00000C   00           DB 0
   \   00000D   00           DB 0
   \   00000E   00           DB 0
   \   00000F   00           DB 0
   \   000010   00           DB 0
   \   000011   00           DB 0
   \   000012   00           DB 0
   \   000013   00           DB 0
   \   000014   00           DB 0
   \   000015   00           DB 0
   \   000016   00           DB 0
   \   000017   00           DB 0
   \   000018   00           DB 0
   \   000019   00           DB 0
   \   00001A   00           DB 0
   \   00001B   00           DB 0
   \   00001C   00           DB 0
   \   00001D   00           DB 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "self:%d   child:%d\\r\\n">`:
   \   000000   73656C66     DB "self:%d   child:%d\015\012"
   \            3A256420
   \            20206368
   \            696C643A
   \            25640D0A
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "< connect success>\\n">`:
   \   000000   3C20636F     DB "< connect success>\012"
   \            6E6E6563
   \            74207375
   \            63636573
   \            733E0A00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0_1`:
   \   000000   00           DB 0
   \   000001   00           DB 0
   \   000002   00           DB 0
   \   000003   00           DB 0
   \   000004   00           DB 0
   \   000005   00           DB 0
   \   000006   00           DB 0
   \   000007   00           DB 0
   \   000008   00           DB 0
   \   000009   00           DB 0
   \   00000A   00           DB 0
   \   00000B   00           DB 0
   \   00000C   00           DB 0
   \   00000D   00           DB 0
   \   00000E   00           DB 0
   \   00000F   00           DB 0
   \   000010   00           DB 0
   \   000011   00           DB 0
   \   000012   00           DB 0
   \   000013   00           DB 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      0      9   SerialApp_CallBack
        0      9   -> SerialApp_Send
      1     62   SerialApp_ConnectReqProcess
        0     51   -> AF_DataRequest
        0     42   -> HalUARTWrite
        0     42   -> NLME_GetShortAddr
        0     46   -> sprintf
        0     42   -> strlen
      0     38   SerialApp_Init
        0     38   -> HalLcdWriteString
        0     38   -> HalUARTOpen
        0     38   -> RegisterForKeys
        0     38   -> ZDO_RegisterForZDOMsg
        0     38   -> afRegister
      0     21   SerialApp_ProcessEvent
        0     21   -> AF_DataRequest
        0     12   -> SerialApp_ProcessMSGCmd
        0     12   -> SerialApp_Send
        0     12   -> osal_msg_deallocate
        0     12   -> osal_msg_receive
        0     12   -> osal_set_event
      0     26   SerialApp_ProcessMSGCmd
        0     11   -> SerialApp_ConnectReqProcess
        0     14   -> osal_memcpy
        0     11   -> osal_set_event
        0     11   -> osal_stop_timerEx
        0     11   -> sendToPc
      0     31   SerialApp_Send
        0     19   -> AF_DataRequest
        0     10   -> HalUARTRead
        0     10   -> osal_set_event
      1     47   sendToPc
        0     36   -> HalUARTWrite


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      20  ?<Constant "< connect success>\n">
      10  ?<Constant "SerialApp">
      21  ?<Constant "self:%d   child:%d\r\n">
      30  ?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
      20  ?<Constant {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0_1
       6  ?<Initializer for SerialApp_epDesc>
       9  ??Subroutine4_0
       5  ?Subroutine0
       5  ?Subroutine1
       9  ?Subroutine2
       2  ?Subroutine3
       1  SampleApp_NwkState
      24  SerialApp_CallBack
       6  SerialApp_CallBack::?relay
       8  SerialApp_ClusterList
     220  SerialApp_ConnectReqProcess
       6  SerialApp_ConnectReqProcess::?relay
     169  SerialApp_Init
       6  SerialApp_Init::?relay
       1  SerialApp_MsgID
     174  SerialApp_ProcessEvent
       6  SerialApp_ProcessEvent::?relay
     180  SerialApp_ProcessMSGCmd
       6  SerialApp_ProcessMSGCmd::?relay
       4  SerialApp_RspBuf
      12  SerialApp_RxAddr
       1  SerialApp_RxSeq
     131  SerialApp_Send
       6  SerialApp_Send::?relay
      12  SerialApp_SimpleDesc
       1  SerialApp_TaskID
      12  SerialApp_TxAddr
      81  SerialApp_TxBuf
       1  SerialApp_TxLen
       1  SerialApp_TxSeq
       6  SerialApp_epDesc
       4  __Constant_1
     200  sendToPc
       6  sendToPc::?relay

 
 1 128 bytes in segment BANKED_CODE
    42 bytes in segment BANK_RELAYS
     6 bytes in segment XDATA_I
     6 bytes in segment XDATA_ID
   125 bytes in segment XDATA_ROM_C
   115 bytes in segment XDATA_Z
 
    48 bytes of CODE     memory
   121 bytes of CONST    memory (+ 4 bytes shared)
 1 128 bytes of HUGECODE memory
   121 bytes of XDATA    memory

Errors: none
Warnings: 2
